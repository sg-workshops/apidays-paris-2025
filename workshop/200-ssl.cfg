frontend dvapi-fe
  bind :80
  ### NEW 
  # Create a secondary SSL bind
  bind :443 ssl crt dvapi.pem 

  ### NEW 
  # Redirect http->https
  http-request redirect scheme https code 307 if !{ ssl_fc }

  acl is_api path,word(1,/) -m str api logout
  use_backend api-be if is_api
  default_backend web-be

  ### NEW 
  # Activate HSTS if connection is over SSL
  #http-after-response set-header strict-transport-security "max-age=31536000" if { ssl_fc }

backend web-be
  server web 127.0.10.1:3000

backend api-be
  server web 127.0.10.2:3000
